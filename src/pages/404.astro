---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import { getCollection } from 'astro:content';

const base = import.meta.env.BASE_URL;
const blogPosts = await getCollection('blog');
const recentPosts = blogPosts
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, 3);

// Process posts to handle co-located images
const processedRecentPosts = recentPosts.map(post => {
  let imageUrl = post.data.image;
  if (typeof post.data.image === 'object' && post.data.image?.src) {
    imageUrl = post.data.image.src;
  }
  return {
    ...post,
    processedImage: imageUrl
  };
});
---

<BaseLayout
  title="Page Not Found - Chiron"
  description="The page you're looking for doesn't exist. Explore our training resources and latest blog posts instead."
>
  <!-- Hero Section -->
  <section class="bg-gradient-to-r from-primary-600 to-primary-800 text-white py-20 md:py-32">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-6xl font-bold mb-6">
        404 - Page Not Found
      </h1>
      <p class="text-xl md:text-2xl text-primary-100 mb-8 max-w-3xl mx-auto">
        Oops! It looks like this page has gone off-course. Don't worry, even the best runners take a wrong turn sometimes.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href={`${base}`}
          class="px-8 py-3 bg-white text-primary-600 font-semibold rounded-lg hover:bg-primary-50 transition-colors"
        >
          Return Home
        </a>
        <a
          href={`${base}blog/`}
          class="px-8 py-3 border-2 border-white text-white font-semibold rounded-lg hover:bg-white hover:text-primary-600 transition-colors"
        >
          Explore the Blog
        </a>
      </div>
    </div>
  </section>

  <!-- Recent Blog Posts -->
  {recentPosts.length > 0 && (
    <section class="py-20 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
            Latest from the Blog
          </h2>
          <p class="text-lg text-gray-600">
            Stay up to date with our latest training tips and insights.
          </p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {processedRecentPosts.map((post) => (
            <BlogCard
              title={post.data.title}
              description={post.data.description}
              pubDate={post.data.pubDate}
              slug={`blog/${post.slug}`}
              image={post.processedImage}
              tags={post.data.tags}
            />
          ))}
        </div>
        <div class="text-center mt-8">
          <a
            href={`${base}blog/`}
            class="inline-block px-6 py-3 text-primary-600 font-medium hover:text-primary-700"
          >
            View all posts â†’
          </a>
        </div>
      </div>
    </section>
  )}
</BaseLayout>
