---
import LandingLayout from '../layouts/LandingLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import { getCollection } from 'astro:content';

const base = import.meta.env.BASE_URL;
const blogPosts = await getCollection('blog');
const recentPosts = blogPosts
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, 3);

// Process posts to handle co-located images
const processedRecentPosts = recentPosts.map(post => {
  let imageUrl = post.data.image;
  if (typeof post.data.image === 'object' && post.data.image?.src) {
    imageUrl = post.data.image.src;
  }
  return {
    ...post,
    processedImage: imageUrl
  };
});
---

<LandingLayout
  title="Chiron - Your Training Companion"
  description="Chiron is the ultimate training platform for coaches, runners, and clubs. Track progress, optimise training, and perform on race day."
>
  <!-- Hero Section -->
  <section slot="hero" class="bg-gradient-to-r from-primary-600 to-primary-800 text-white py-20 md:py-32">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-6xl font-bold mb-6">
        Plan. Adapt. Perform.
      </h1>
      <p class="text-xl md:text-2xl text-primary-100 mb-8 max-w-3xl mx-auto">
        Chiron is the ultimate training platform for coaches, runners, and clubs. Track progress, optimise training, and perform on race day.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href={`${base}contact/`}
          class="px-8 py-3 bg-white text-primary-600 font-semibold rounded-lg hover:bg-primary-50 transition-colors"
        >
          Get Started
        </a>
        <a
          href={`${base}about/`}
          class="px-8 py-3 border-2 border-white text-white font-semibold rounded-lg hover:bg-white hover:text-primary-600 transition-colors"
        >
          Learn More
        </a>
      </div>
    </div>
  </section>

  <!-- All Feature Sections -->
  <div slot="features">
    <!-- Train Smarter Section -->
    <section class="py-20 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
            Train Smarter. Run Faster.
          </h2>
          <p class="text-lg text-gray-600 max-w-2xl mx-auto">
            Set goals, track every session, and get insights that actually reduce injury risk and improve performance. Chiron removes the hassle of spreadsheets and manual tracking, so you can focus on what matters.
          </p>
        </div>
      </div>
    </section>

    <!-- Collaborate Section -->
    <section class="py-20 bg-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
            Collaborate Effortlessly
          </h2>
          <p class="text-lg text-gray-600 max-w-2xl mx-auto">
            Coaches, athletes, and clubs can share plans, monitor progress, and stay in sync. Teamwork has never been this simple.
          </p>
        </div>
      </div>
    </section>

    <!-- AI Coaching Section -->
    <section class="py-20 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
            AI Coaching, Made Simple
          </h2>
          <p class="text-lg text-gray-600 max-w-2xl mx-auto">
            Chiron's Assistant Coach AI helps coaches do more for their athletes. Quickly spot performance trends, identify potential issues, and tailor training—all at scale—so every athlete reaches their potential.
          </p>
        </div>
      </div>
    </section>

    <!-- Race Day Section -->
    <section class="py-20 bg-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
            Race Day, Reimagined
          </h2>
          <p class="text-lg text-gray-600 max-w-2xl mx-auto">
            Organising a race? Chiron handles manual and RFID chip timing, start lists, and live results. Keep events smooth, accurate, and stress-free.
          </p>
          <a href={`${base}race-organisers/`} class="inline-block mt-4 text-primary-600 font-medium hover:text-primary-700">
            Learn More →
          </a>
        </div>
      </div>
    </section>

    <!-- Recent Blog Posts -->
    {recentPosts.length > 0 && (
      <section class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
              Latest from the Blog
            </h2>
            <p class="text-lg text-gray-600">
              Stay up to date with our latest training tips and insights.
            </p>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {processedRecentPosts.map((post) => (
              <BlogCard
                title={post.data.title}
                description={post.data.description}
                pubDate={post.data.pubDate}
                slug={`blog/${post.slug}`}
                image={post.processedImage}
                tags={post.data.tags}
              />
            ))}
          </div>
          <div class="text-center mt-8">
            <a
              href={`${base}blog/`}
              class="inline-block px-6 py-3 text-primary-600 font-medium hover:text-primary-700"
            >
              View all posts →
            </a>
          </div>
        </div>
      </section>
    )}
  </div>

  <!-- CTA Section -->
  <section slot="cta" class="py-20 bg-primary-600">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
        Ready to Run Smarter?
      </h2>
      <p class="text-lg text-primary-100 mb-8">
        Join Chiron today. Plan your training, adapt with insight, and perform at your best—on and off the track.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href={`${base}contact/`}
          class="px-8 py-3 bg-white text-primary-600 font-semibold rounded-lg hover:bg-primary-50 transition-colors"
        >
          Sign Up
        </a>
        <a
          href={`${base}about/`}
          class="px-8 py-3 border-2 border-white text-white font-semibold rounded-lg hover:bg-white hover:text-primary-600 transition-colors"
        >
          Explore Features
        </a>
      </div>
    </div>
  </section>
</LandingLayout>
